---
title: "Slot Efficiency"
format: html
execute:
    echco: false
---


```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(readr)
library(ggplot2)
library(ggpubr)
library(plotly)

# 1. LOAD DATA
df <- read_csv("data/pitcher_profiles.csv")

# 2. CREATE METRIC & FILTER
df$torque_efficiency <- df$elbow_varus_moment / df$pitch_speed_mph
plot_data <- df[!is.na(df$arm_slot) & !is.na(df$torque_efficiency), ]

# 3. CREATE THE LABEL
cor_val <- cor(plot_data$arm_slot, plot_data$torque_efficiency)
label_text <- paste("R =", round(cor_val, 2)) 

# 4. PREPARE LABEL POSITION (Top Left Corner)
# We create a tiny dataframe just for the text. This forces Plotly to draw it.
text_data <- data.frame(
  x = min(plot_data$arm_slot), 
  y = max(plot_data$torque_efficiency), 
  label = label_text
)

# 5. PLOT
eff_plot <- ggplot(plot_data, aes(x = arm_slot, y = torque_efficiency)) + 
  
  # Scatter Points
  geom_point(aes(color = torque_efficiency, 
                 text = paste("Pitcher:", user,
                              "<br>Arm Slot:", round(arm_slot, 1), "deg",
                              "<br>Efficiency:", round(torque_efficiency, 2), "Nm/mph",
                              "<br>Raw Velo:", round(pitch_speed_mph, 1), "mph")), 
             alpha = 0.7, size = 3) +
  
  scale_color_gradient(low = "blue", high = "red", name = "Stress Cost") +
  geom_smooth(method = "lm", color = "black", se = TRUE) +
  
  # --- THE FIX: Using geom_text instead of annotate ---
  geom_text(data = text_data, aes(x = x, y = y, label = label),
            color = "black", size = 6, hjust = 0, vjust = 1, fontface = "bold") +
  # ----------------------------------------------------
  
  labs(
    title = "Myth #5: Does Arm Slot Affect Efficiency?",
    subtitle = "Relationship between Arm Slot and Torque Cost per MPH",
    x = "Arm Slot (Degrees)",
    y = "Torque Efficiency (Nm per MPH)"
  ) +
  
  theme_minimal()

# 6. DISPLAY
ggplotly(eff_plot, tooltip = "text")
```

show a picture of one pitcher and then the circle that shows different slots
